name: "[Temp] Fix prod .env conflict"

on:
  workflow_dispatch:

jobs:
  fix:
    runs-on: ubuntu-latest
    steps:
      - name: Stash .env and pull latest
        uses: appleboy/ssh-action@v1.2.5
        with:
          host: ${{ secrets.EC2_HOST }}
          username: ${{ secrets.EC2_USERNAME }}
          key: ${{ secrets.EC2_SSH_PRIVATE_KEY }}
          port: 22
          command_timeout: 3m
          script: |
            cd /opt/chat-app
            echo "=== Current git status ==="
            git status --short
            echo "=== Stashing local changes ==="
            git stash
            echo "=== Pulling latest ==="
            git pull origin main
            echo "=== Restoring .env ==="
            git stash pop || echo "No stash to pop or conflict"
            echo "=== Done ==="
            git status --short
