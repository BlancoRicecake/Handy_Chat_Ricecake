# ===================================================================
# Production Environment Configuration Template
# ===================================================================
# Copy this file to .env.production and fill in actual values
# NEVER commit .env.production to version control!
#
# Setup Guide: docs/deployment/AWS_DEPLOYMENT_GUIDE.md
# ===================================================================

# Server Configuration
NODE_ENV=production
PORT=3000
HOST=0.0.0.0
TRUST_PROXY=1

# Database - MongoDB Atlas or AWS DocumentDB
# ⚠️ IMPORTANT: URL encode special characters in password!
# Example: p@ssw0rd → p%40ssw0rd
# Tool: encodeURIComponent() in JavaScript or https://www.urlencoder.org/
MONGO_URI=mongodb+srv://prod-user:YOUR_ENCODED_PASSWORD@cluster.xxxxx.mongodb.net/chatdb?retryWrites=true&w=majority

# Redis - AWS ElastiCache or Redis Cloud
# Format: redis://[password@]host:port/db
# ElastiCache example: redis://master.xxxxx.cache.amazonaws.com:6379/0
# With password: redis://:your_password@master.xxxxx.cache.amazonaws.com:6379/0
REDIS_URL=redis://master.xxxxx.use1.cache.amazonaws.com:6379/0

# Security - JWT (AWS Secrets Manager Recommended)
# Phase 3 Configuration (Refresh Tokens Enabled)
USE_AWS_SECRETS=true
AWS_REGION=us-east-1
AWS_SECRET_NAME=chat-app/jwt-secrets
SECRET_CACHE_TTL=300000
AWS_SECRETS_FAIL_OPEN=false

# Fallback JWT Secrets (if AWS Secrets Manager unavailable)
# Generate: openssl rand -base64 64
JWT_SECRET_CURRENT=CHANGE_THIS_MINIMUM_64_CHARS_PRODUCTION_SECRET_USE_AWS_SECRETS_MANAGER
JWT_SECRET_PREVIOUS=

# Token Expiry
ACCESS_TOKEN_EXPIRY=15m
REFRESH_TOKEN_EXPIRY=7d
JWT_CLOCK_TOLERANCE=60

# Feature Flags (Phase 3 - Refresh Tokens)
USE_ROTATED_JWT=true
ENABLE_REFRESH_TOKEN=true
ENFORCE_SINGLE_SESSION=false

# Security - CORS
# ⚠️ CRITICAL: Set to your actual production domain(s)
# Example: https://yourdomain.com,https://app.yourdomain.com
CORS_ORIGIN=https://yourdomain.com,https://api.yourdomain.com

# Logging
LOG_LEVEL=info

# S3 Storage - AWS S3
# ⚠️ IMPORTANT: S3_ENDPOINT must be empty for AWS S3!
S3_ENDPOINT=
S3_BUCKET_NAME=prod-chat-files
S3_ACCESS_KEY=AKIA...
S3_SECRET_KEY=...
S3_REGION=us-east-1
S3_USE_PATH_STYLE=false

# ===================================================================
# Production Deployment Checklist
# ===================================================================
# Before deploying to production, ensure:
#
# 1. Infrastructure Setup:
#    □ MongoDB Atlas Private Endpoint or VPC Peering configured
#    □ ElastiCache Redis cluster created (cache.t3.micro minimum)
#    □ S3 bucket created with encryption and versioning enabled
#    □ AWS Secrets Manager secret created (chat-app/jwt-secrets)
#    □ IAM role with policies for EC2 (Secrets Manager, S3 access)
#    □ Security groups configured (allow 80, 443 inbound)
#
# 2. MongoDB:
#    □ Create dedicated database user (readWrite role only)
#    □ Disable public access
#    □ Enable PITR backups
#    □ Run: npm run create-indexes
#
# 3. Redis:
#    □ Enable encryption in-transit (TLS)
#    □ Enable encryption at-rest
#    □ Configure automatic backups (daily minimum)
#    □ Set requirepass (32+ characters)
#
# 4. S3:
#    □ Enable bucket encryption (AES-256 or KMS)
#    □ Enable versioning
#    □ Configure lifecycle policies
#    □ Set CORS policy for your domain
#
# 5. Environment Variables:
#    □ All secrets stored in AWS Secrets Manager
#    □ MONGO_URI special characters URL encoded
#    □ CORS_ORIGIN set to production domain(s)
#    □ JWT_SECRET_CURRENT is 64+ characters
#    □ S3_ENDPOINT is empty (for AWS S3)
#
# 6. Application:
#    □ Update Caddyfile with production domain
#    □ Run database migrations/indexes
#    □ Test /health endpoint
#    □ Configure CloudWatch logging
#
# 7. Monitoring:
#    □ CloudWatch alarms configured
#    □ Log aggregation setup
#    □ Health check configured (ALB or Caddy)
#
# Deployment Guide: docs/deployment/AWS_DEPLOYMENT_GUIDE.md
# Recovery Playbook: server/docs/RECOVERY_PLAYBOOK.md
