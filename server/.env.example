# Server Configuration
PORT=3000
NODE_ENV=development

# Server Binding
# - Reverse proxy (Nginx/Caddy): HOST=127.0.0.1 (recommended)
# - Docker container: HOST=0.0.0.0
# - Local standalone: HOST=0.0.0.0
HOST=127.0.0.1
TRUST_PROXY=1

# Database
# MongoDB connection URI
MONGO_URI=mongodb://localhost:27017/chatdb

# ⚠️ MongoDB URI 특수문자 주의사항:
# @, :, /, ?, # 등의 특수문자는 URL 인코딩 필수
#
# 예시:
#   원본: p@ssw0rd       → 인코딩: p%40ssw0rd
#   원본: pass:word      → 인코딩: pass%3Aword
#   원본: 비밀번호123     → 인코딩: %EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8123
#
# JavaScript: encodeURIComponent('비밀번호')
# Online tool: https://www.urlencoder.org/
#
# 올바른 예:
# MONGO_URI=mongodb://user:p%40ssw0rd@host:27017/chatdb

# Security - JWT
# IMPORTANT: Generate strong random secrets (minimum 32 characters each)
# Example: openssl rand -base64 32
# NEVER use the default value in production!

# Legacy mode (Phase 1): Use JWT_SECRET only
# JWT_SECRET=CHANGE_THIS_TO_A_STRONG_RANDOM_SECRET_MINIMUM_32_CHARS

# Rotation mode (Phase 2+): Use JWT_SECRET_CURRENT and JWT_SECRET_PREVIOUS
JWT_SECRET_CURRENT=CHANGE_THIS_TO_A_STRONG_RANDOM_SECRET_MINIMUM_32_CHARS
JWT_SECRET_PREVIOUS=

# Token expiry settings (Phase 3+)
ACCESS_TOKEN_EXPIRY=15m
REFRESH_TOKEN_EXPIRY=7d

# JWT clock tolerance in seconds (allows for time drift between servers)
JWT_CLOCK_TOLERANCE=60

# Security - CORS
# Comma-separated list of allowed origins
# Examples:
#   Development: http://localhost:3000,http://localhost:8080
#   Production: https://yourdomain.com,https://app.yourdomain.com
# NEVER use '*' in production!
CORS_ORIGIN=http://localhost:3000,http://localhost:8080

# Logging
LOG_LEVEL=info

# Chat Server Proxy
# Proxy target for /chat-api/* requests to avoid Mixed Content issues
# Default: http://16.176.147.141 (if not set)
CHAT_SERVER_URL=http://16.176.147.141

# S3 Storage
# AWS S3: S3_ENDPOINT는 비워두기 (""), S3_USE_PATH_STYLE=false
# MinIO: S3_ENDPOINT=http://minio:9000, S3_USE_PATH_STYLE=true
S3_ENDPOINT=http://localhost:9000
S3_BUCKET_NAME=chat-files
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
S3_REGION=us-east-1
S3_USE_PATH_STYLE=true

# Production AWS S3 example:
# S3_ENDPOINT=
# S3_BUCKET_NAME=prod-chat-files
# S3_ACCESS_KEY=AKIA...
# S3_SECRET_KEY=...
# S3_REGION=us-east-1
# S3_USE_PATH_STYLE=false

# Redis (optional, for caching/sessions)
# Recommended: REDIS_URL (supports password)
REDIS_URL=redis://localhost:6379/0
# Or separate configuration (compatibility):
# REDIS_HOST=redis
# REDIS_PORT=6379

# AWS Secrets Manager (Production)
USE_AWS_SECRETS=false
AWS_REGION=us-east-1
AWS_SECRET_NAME=chat-app/jwt-secrets
SECRET_CACHE_TTL=300000
# Fail policy (recommended: false = boot fails if secrets load fails)
# true = fall back to env vars, false = shutdown on failure
AWS_SECRETS_FAIL_OPEN=false

# Feature Flags (Gradual Rollout)
# Phase 1: All false (legacy 7-day tokens)
# Phase 2: USE_ROTATED_JWT=true (enable secret rotation)
# Phase 3: ENABLE_REFRESH_TOKEN=true (15min access + 7day refresh)
# Phase 4: ENFORCE_SINGLE_SESSION=true (single device per user)
USE_ROTATED_JWT=false
ENABLE_REFRESH_TOKEN=false
ENFORCE_SINGLE_SESSION=false

# === 프로덕션 배포 체크리스트 ===
# 상세 문서: docs/DATABASE_SETUP.md, docs/OPERATIONAL_CHECKLIST.md
#
# 배포 전 필수 확인:
# □ MongoDB Atlas Private Endpoint 또는 VPC Peering 설정
# □ Public Access OFF, IP Allowlist 제거
# □ 앱 전용 DB 사용자 생성 (readWrite 권한만)
# □ MONGO_URI 특수문자 URL 인코딩 확인
# □ npm run create-indexes 실행
# □ Redis requirepass 설정 (32자 이상)
# □ Redis ACL 사용자 생성 (위험 명령 차단)
# □ AOF everysec + RDB 영속성 설정
# □ AWS Secrets Manager 설정 (프로덕션)
# □ 필수 환경변수 검증 (EnvValidationService)
#
# 배포 후 즉시 확인 (5분):
# □ GET /health → 200 OK
# □ 회원가입/로그인 테스트
# □ WebSocket 연결 정상
# □ 보호된 엔드포인트 접근 (JWT)
#
# 30분 모니터링:
# □ 연결 오류율 < 0.5%
# □ P95 응답 시간: /health < 50ms, /messages < 100ms
# □ MongoDB 쿼리 < 50ms (P95)
# □ Redis 명령 < 5ms
# □ API CPU < 70%, Memory < 80%
# □ MongoDB CPU < 70%, Redis Memory < 70%
#
# 복구 목표 (SLA):
# - RTO (복구 시간): 30분
# - RPO (복구 시점): 5분
# - 분기별 복구 리허설 수행 (docs/RECOVERY_PLAYBOOK.md)
